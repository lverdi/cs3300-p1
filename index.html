<html>
<head>
<title>INFO 3300 - Data-driven Web Applications</title>
<link href="https://fonts.googleapis.com/css?family=Poppins" rel="stylesheet">
<script src="https://d3js.org/d3.v4.min.js"></script>
<style>
body { font-family: 'Poppins'; }
</style>
</head>
<body>
<div id="title" align="center" style="height: 10%"></div>
<div id="content" align="center" style="height: 70%"></div>
<div id="key" align="center" style="height: 20%"></div>
	<script>
		var height = document.getElementById("content").clientHeight;
		var width = document.getElementById("content").clientWidth;
		var centerX = width / 2;
		var centerY = height / 2;
		var graphRadius = height * 0.4;

		var colors = ["red", "yellow", "blue", "pink", "black", "purple", "green", "orange"];
		var methodsOfTravel = ["Mystery Force", "Machine/Tech", "Automobile", "Alien Tech", "Unknown", "Power of Mind", "Freezing", "Slingshot"];

		var svg = d3.selectAll("#content").append("svg")
			.attr("height", height)
			.attr("width", width);

		var pre1900Scale = d3.scaleLinear().domain([1200, 1899]).range([75, 204]);
		var mainScale = d3.scaleLinear().domain([1900, 1999]).range([205, 334]);
		var post2000Scale = d3.scaleLinear().domain([2000, 2500]).range([-25, 50]);
		
		function drawTimeline() {
			var timeline = svg.append("circle")
				.attr("r", graphRadius)
				.attr("cx", centerX)
				.attr("cy", centerY)
				.attr("stroke", "black")
				.attr("stroke-width", 4)
				.style("fill", "none");

			var arc = d3.arc()
			    .innerRadius(graphRadius - 2)
			    .outerRadius(graphRadius + 2)
			    .startAngle(38 * Math.PI / 180)
			    .endAngle(17 * Math.PI / 180);

			svg.append("path")
				.attr("d", arc)
				.attr("stroke", "white")
				.attr("stroke-width", 10)
				.attr("transform", "translate(" + centerX + ", " + centerY + ")");	
		}

		function drawTitle() {
			var titleHeight = document.getElementById("title").clientHeight;
			var titleWidth = document.getElementById("title").clientWidth;

			var title =  d3.selectAll("#title").append("svg")
				.attr("height", titleHeight)
				.attr("width", titleWidth);

			title.append("text")
				.text("TIME TRAVEL IN FILM AND TELEVISION")
				.attr("x", titleWidth/2)
				.attr("y", titleHeight/2)
				.attr("text-anchor", "middle")
				.attr("alignment-baseline", "middle")
				.style("font-size", 35);
		}

		function scaledYear (year) {
			if (year >= 1200 && year < 1900) {
				return pre1900Scale(year);
			} else if (year >= 1900 && year < 2000) {
				return mainScale(year);
			} else if (year >= 2000 && year <= 2500) {
				return post2000Scale(year);
			} else {
				console.log("Year is invalid");
			}
		}

		function plotAngleRadius (angle, radius) {
			var x = (radius * Math.cos(angle * Math.PI / 180)) + centerX;
			var y = centerY - (radius * Math.sin(angle * Math.PI / 180));
			return [x, y];
		}

		function plotYear (year) {
			return plotAngleRadius(scaledYear(year), graphRadius);
		}

		function drawLabels(y, dist, size) {
			svg.append("text").text(y)
				.attr("x", plotAngleRadius(scaledYear(y), graphRadius + dist)[0])
				.attr("y", plotAngleRadius(scaledYear(y), graphRadius + dist)[1])
				.attr("text-anchor", "middle")
				.attr("alignment-baseline", "middle")
				.style("font-size", size);
		}

		function drawTick (y, size) {
			var inner = plotAngleRadius(scaledYear(y), graphRadius - size);
			var outer = plotAngleRadius(scaledYear(y), graphRadius + size);

			var tickFunct = d3.line()
				.x(function (d) { return d[0]; })
				.y(function (d) { return d[1]; });
			var tick = tickFunct([inner, outer]);

			svg.append("path")
				.attr("d", tick)
				.attr("stroke", "black")
				.attr("stroke-width", 2)
				.attr("fill", "none");
		}

		function drawTicks () {
			for (var y = 1200; y <= 2500; y += 100) {
				drawTick(y, 15);
				drawLabels(y, 35, 20);
			}
			for (var y = 1200; y < 1900; y += 25) {
				drawTick(y, 6);
			}
			for (var y = 2000; y <= 2500; y += 25) {
				drawTick(y, 6);
			}
			for (var y = 1910; y <= 1990; y += 10) {
				drawTick(y, 6);
				drawLabels(y, 30, 13);
			}
		}

		function drawColorKey() {
			var keyWidth = document.getElementById("key").clientWidth;
			var keyHeight = document.getElementById("key").clientHeight;
			var lineWidth = 3;
			var widthCounter = .1;	
			var counter = 0;

			var key = d3.selectAll("#key").append("svg")
				.attr("height", keyHeight)
				.attr("width", keyWidth);

			key.append("text")
				.text("TRAVEL BY...")
				.attr("x", keyWidth/2)
				.attr("y", .15*keyHeight)
				.attr("text-anchor", "middle")
				.attr("alignment-baseline", "middle")
				.style("font-size", 20);

			key.append("rect")
				.attr("x", 1)
				.attr("y", 1)
				.attr("height", keyHeight - lineWidth)
				.attr("width", keyWidth - lineWidth)
				.style("fill", "none")
				.style("stroke", "black")
				.style("stroke-width", lineWidth);

			methodsOfTravel.forEach(function (method) {
				if (counter < 4) {
					key.append("rect")
						.attr("x", widthCounter*keyWidth)
						.attr("y", .3*keyHeight)
						.attr("height", .2*keyHeight)
						.attr("width", .05*keyWidth)
						.style("fill", colors[counter])
						.style("stroke", "black")
						.style("stroke-width", lineWidth);
					key.append("text")
						.text(method)
						.attr("x", (widthCounter + .07)*keyWidth)
						.attr("y", .45*keyHeight)
						.attr("text-anchor", "start")
					widthCounter += .2;
				}
				else {
					widthCounter -= .2;
					key.append("rect")
						.attr("x", widthCounter*keyWidth)
						.attr("y", .6*keyHeight)
						.attr("height", .2*keyHeight)
						.attr("width", .05*keyWidth)
						.style("fill", colors[counter])
						.style("stroke", "black")
						.style("stroke-width", lineWidth);
					key.append("text")
						.text(method)
						.attr("x", (widthCounter + .07)*keyWidth)
						.attr("y", .75*keyHeight)
						.attr("text-anchor", "start")
				}
				counter += 1;
			});	
		}

		drawTitle();
		drawColorKey();
		drawTimeline();
		drawTicks();

	</script>
</svg>
</body>
</html>
